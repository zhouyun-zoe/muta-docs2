<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.54">


<title data-react-helmet="true">Tutorial：使用 Muta 框架从零开发一条 Dex 专有链 | Muta</title>

<meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Tutorial：使用 Muta 框架从零开发一条 Dex 专有链 | Muta"><meta data-react-helmet="true" name="description" content="我们的目标是开发一条链上挂单、链上撮合、链上成交的简易 dex 专有链，旨在通过 step by step 的流程，帮助开发者熟悉 Muta 框架，学会如何使用框架开发自己的区块链。"><meta data-react-helmet="true" property="og:description" content="我们的目标是开发一条链上挂单、链上撮合、链上成交的简易 dex 专有链，旨在通过 step by step 的流程，帮助开发者熟悉 Muta 框架，学会如何使用框架开发自己的区块链。"><meta data-react-helmet="true" property="og:url" content="https://zhouyun-zoe.github.io/muta-docs2/docs/dex">

<link data-react-helmet="true" rel="shortcut icon" href="/muta-docs2/img/muta-logo.png">


<link rel="stylesheet" href="/muta-docs2/styles.e2aa70e3.css">


<link rel="preload" href="/muta-docs2/styles.5d16af36.js" as="script">

<link rel="preload" href="/muta-docs2/runtime~main.8a98f0f0.js" as="script">

<link rel="preload" href="/muta-docs2/main.c645a1d4.js" as="script">

<link rel="preload" href="/muta-docs2/1.570d2204.js" as="script">

<link rel="preload" href="/muta-docs2/2.e2d3cc65.js" as="script">

<link rel="preload" href="/muta-docs2/3.a6f7c6e9.js" as="script">

<link rel="preload" href="/muta-docs2/1be78505.009a25e0.js" as="script">

<link rel="preload" href="/muta-docs2/78ab87d2.97744ea4.js" as="script">

<link rel="preload" href="/muta-docs2/17896441.ccc93767.js" as="script">

<link rel="preload" href="/muta-docs2/75b4e168.ebe0ad04.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top navbarHideable_OaSq"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/muta-docs2/"><img class="navbar__logo" src="/muta-docs2/img/muta-logo.png" alt="Muta Logo"><strong class="navbar__title">Muta</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/muta-docs2/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/muta-docs2/blog">Blog</a><a class="navbar__item navbar__link" href="/muta-docs2/showcase">Showcase</a><a class="navbar__item navbar__link" href="/muta-docs2/docs/support">Support</a></div><div class="navbar__items navbar__items--right"><a target="_blank" rel="noopener noreferrer" href="https://github.com/nervosnetwork/muta" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/muta-docs2/"><img class="navbar__logo" src="/muta-docs2/img/muta-logo.png" alt="Muta Logo"><strong class="navbar__title">Muta</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" position="left" href="/muta-docs2/docs/intro">Docs</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/muta-docs2/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/muta-docs2/showcase">Showcase</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/muta-docs2/docs/support">Support</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/nervosnetwork/muta" class="menu__link" position="right">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><a tabindex="-1" class="sidebarLogo_3ono" href="/muta-docs2/"><img src="/muta-docs2/img/muta-logo.png" alt="Muta Logo"><strong>Muta</strong></a><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">介绍</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/muta-docs2/docs/intro">介绍</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">快速开始</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/muta-docs2/docs/getting_started">快速入门</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/muta-docs2/docs/config">配置说明</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/muta-docs2/docs/multi_node_deploy">多节点部署指南</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">架构设计</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/muta-docs2/docs/transaction_pool">Mempool</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/muta-docs2/docs/overlord">Overlord 架构设计</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/muta-docs2/docs/network">网络设计</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/muta-docs2/docs/storage">存储设计</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">密码学</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/muta-docs2/docs/crypto">密码学</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Service介绍</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/muta-docs2/docs/service_dev">Service 开发指南</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/muta-docs2/docs/service_eg">Service 示例</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/muta-docs2/docs/built_in_service">内置 Service 说明</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">开发指南</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" tabindex="0" href="/muta-docs2/docs/dex">DEX 开发指南</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">接口</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/muta-docs2/docs/graphql">GraphQL</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">SDK</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/muta-docs2/docs/js_sdk">JS-SDK</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">常见问题</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/muta-docs2/docs/faq">FAQ</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">贡献说明</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/muta-docs2/docs/contribute">贡献代码</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Tutorial：使用 Muta 框架从零开发一条 Dex 专有链</h1></header><div class="markdown"><p>我们的目标是开发一条链上挂单、链上撮合、链上成交的简易 dex 专有链，旨在通过 step by step 的流程，帮助开发者熟悉 Muta 框架，学会如何使用框架开发自己的区块链。</p><blockquote><p>在开始本教程之前，开发者需要先学习 <a href="/muta-docs2/docs/service_dev">Service 开发指南</a></p></blockquote><p>我们按照 <a href="/muta-docs2/docs/service_dev">Service 开发指南</a> 中提到的，使用 Muta 框架开发自己的区块链流程，来开发这条 dex 专有链：</p><ol><li>思考自己链的专属需求，确定需要哪些 Service</li><li>如果需要的 Service 有现成的，可以直接复用；如果没有，可以自己开发</li><li>将这些 Service 接入框架，编译运行！</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="1-思考需要的-service"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#1-思考需要的-service" title="Direct link to heading">#</a>1. 思考需要的 Service</h2><p>我们一共需要 2 个 Service，除了 Dex Service 外，由于 Dex 链需要有进行交易的资产，所以还需要一个 Asset Service。Asset Service 除了常见的发行、转账、查询功能外，还需要一个锁定资产功能。因为用户发起挂单交易时，需要锁定用户资产，确保成交时有足够的余额来完成交易。Dex 订单成交时，需要修改用户资产余额，所以 Asset Service 需要提供修改余额接口，并且该接口只能由 Dex Service 调用，无法被用户直接调用。我们将 Asset Service 的接口定义如下：</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-rust codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[cycles(210_00)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[write]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fn create_asset(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &amp;mut self,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ctx: ServiceContext,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    payload: CreateAssetPayload,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; ProtocolResult&lt;Asset&gt;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[cycles(100_00)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[read]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fn get_asset(&amp;self, ctx: ServiceContext, payload: GetAssetPayload) -&gt; ProtocolResult&lt;Asset&gt;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[cycles(210_00)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[write]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fn transfer(&amp;mut self, ctx: ServiceContext, payload: TransferPayload) -&gt; ProtocolResult&lt;()&gt; ;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[cycles(100_00)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[read]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fn get_balance(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &amp;self,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ctx: ServiceContext,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    payload: GetBalancePayload,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; ProtocolResult&lt;GetBalanceResponse&gt;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[cycles(210_00)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[write]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fn lock_value(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &amp;mut self,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ctx: ServiceContext,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    payload: ModifyBalancePayload,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; ProtocolResult&lt;()&gt;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[cycles(210_00)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[write]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fn unlock_value(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &amp;mut self,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ctx: ServiceContext,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    payload: ModifyBalancePayload,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; ProtocolResult&lt;()&gt;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[cycles(210_00)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[write]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fn add_value(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &amp;mut self,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ctx: ServiceContext,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    payload: ModifyBalancePayload,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; ProtocolResult&lt;()&gt;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[cycles(210_00)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[write]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fn sub_value(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &amp;mut self,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ctx: ServiceContext,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    payload: ModifyBalancePayload,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; ProtocolResult&lt;()&gt;;</span></div></div></div></div></div><p>Dex Service 包含的功能有：</p><ol><li>增加交易对</li><li>查询交易对</li><li>发起挂单交易（买或卖）</li><li>每个 block 执行结束后，匹配订单并成交</li><li>查询订单状态</li></ol><p>功能 1、2、3、5 可由用户调用 Servcie 接口触发：</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-rust codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #[cycles(210_00)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #[write]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fn add_trade(&amp;mut self, ctx: ServiceContext, payload: AddTradePayload) -&gt; ProtocolResult&lt;()&gt;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #[read]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fn get_trades(&amp;self, _ctx: ServiceContext) -&gt; ProtocolResult&lt;GetTradesResponse&gt;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #[cycles(210_00)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #[write]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fn order(&amp;mut self, ctx: ServiceContext, payload: OrderPayload) -&gt; ProtocolResult&lt;()&gt;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #[read]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fn get_order(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &amp;self,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ctx: ServiceContext,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        payload: GetOrderPayload,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ) -&gt; ProtocolResult&lt;GetOrderResponse&gt;;</span></div></div></div></div></div><p>功能 4 由 <code>#[hook_after]</code> 自动触发：</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-rust codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #[hook_after]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fn match_and_deal(&amp;mut self, params: &amp;ExecutorParams) -&gt; ProtocolResult&lt;()&gt;;</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="2-开发-asset-service，dex-service"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#2-开发-asset-service，dex-service" title="Direct link to heading">#</a>2. 开发 Asset Service，Dex Service</h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="使用脚手架-muta-drone-对-service-进行初始化"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#使用脚手架-muta-drone-对-service-进行初始化" title="Direct link to heading">#</a>使用脚手架 muta-drone 对 Service 进行初始化</h3><p>Service 设计完成后，我们进入开发阶段。我们需要新建一个 rust 工程，同时在工程中引用 Muta Library，好消息是 Muta 框架提供了脚手架 <a href="https://www.npmjs.com/package/muta-drone">muta-drone</a> 来帮助开发者一键配置工程目录。</p><ul><li>安装脚手架</li></ul><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">npm</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> -g muta-drone</span></div></div></div></div></div><ul><li>运行 <code>drone node</code> 命令，按提示配置工程目录</li></ul><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> drone node</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ? The name of your chain. muta-tutorial-dex     // 工程目录命</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ? The chain </span><span class="token function" style="color:rgb(130, 170, 255)">id</span><span class="token plain"> of your chain </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">32</span><span class="token plain">-Hash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">default: random generation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">     // 回车键使用默认值</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ? Private key of this node </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">secp256k1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">default: random generation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">     // 回车键使用默认值</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ? Verifier&#x27;s address set, except you </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">eg. </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">0x1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">., 0x2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">      // 回车键使用默认值</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ? cycles limit </span><span class="token number" style="color:rgb(247, 140, 108)">1099511627776</span><span class="token plain">        // 回车键使用默认值</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Downloading template</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Copying template</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    All right, enjoy</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Enter the following </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">command</span><span class="token plain"> to start your chain</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> muta-tutorial-dex </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> cargo run</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    When the rust compilation is complete, access graphiql play your chain.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $ </span><span class="token function" style="color:rgb(130, 170, 255)">open</span><span class="token plain"> http://localhost:8000/graphiql</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span></div></div></div></div></div><p>muta-tutorial-dex 目录结构如下：</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./muta-tutorial-dex</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── Cargo.lock</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── Cargo.toml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── LICENSE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── README.md</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│   ├── chain.toml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│   └── genesis.toml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── rust-toolchain</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── services</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│   └── metadata</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│       ├── Cargo.toml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│       └── src</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│           └── lib.rs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">└── src</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    └── main.rs</span></div></div></div></div></div><p>可以看到，目录主要包含 config，services 和 src 三个子目录：</p><ul><li>config：链的配置信息</li><li>services：包含链的所有 service</li><li>src：这条链的 bin 目录，在 main.rs 中，我们将 services 接入 muta library，并启动整条链</li></ul><p>services 目录中包含了一个 <a href="https://github.com/nervosnetwork/muta-template/tree/master/node-template/services/metadata">metadata service</a>，该 service 为系统内置 service。我们需要在 services 目录中加上 asset service 和 dex service，脚手架 muta-drone 也有命令帮助我们构建 service 目录。</p><ul><li>运行 <code>drone service</code> 命令，构建 service 工程目录</li></ul><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> muta-tutorial-dex</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> drone </span><span class="token function" style="color:rgb(130, 170, 255)">service</span><span class="token plain"> asset</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Downloading template</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Copying template</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Done</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain"> asset </span><span class="token function" style="color:rgb(130, 170, 255)">service</span><span class="token plain"> path /patht/o/muta-tutorial-dex/services/asset</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> drone </span><span class="token function" style="color:rgb(130, 170, 255)">service</span><span class="token plain"> dex</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Downloading template</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Copying template</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Done</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain"> asset </span><span class="token function" style="color:rgb(130, 170, 255)">service</span><span class="token plain"> path /path/to/muta-tutorial-dex/services/dex</span></div></div></div></div></div><p>Service 工程目录如下：</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./asset</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── Cargo.toml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── rust-toolchain</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">└── src</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ├── lib.rs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    └── types.rs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">./dex</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── Cargo.toml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── rust-toolchain</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">└── src</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ├── lib.rs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    └── types.rs</span></div></div></div></div></div><p>可以看到 <a href="https://github.com/nervosnetwork/muta-template/blob/master/service-template/src/lib.rs">lib.rs</a> 和 <a href="https://github.com/nervosnetwork/muta-template/blob/master/service-template/src/types.rs">types.rs</a> 默认帮我们实现了一个简单的读写 key-value 的 service。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="编写-asset-service"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#编写-asset-service" title="Direct link to heading">#</a>编写 Asset Service</h3><p>学习完 <a href="/muta-docs2/docs/service_dev">Service 开发指南</a>，相信读者对如何开发 asset service 已经有了一定的想法，并且能够阅读 <a href="https://github.com/mkxbl/muta-tutorial-dex/tree/master/services/asset">asset service</a> 源码。这里就不复述相关内容，仅向读者说明一些需要注意的地方：</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="代码结构"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#代码结构" title="Direct link to heading">#</a>代码结构</h4><p>Service 的组件定义在 lib.rs 中，组件需要用到的数据结构，如输入输出参数(<code>TransferPayload</code>)、事件类型(<code>TransferEvent</code>)、存储类型(<code>Asset</code>)定义在 types.rs 中。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="创世配置"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#创世配置" title="Direct link to heading">#</a>创世配置</h4><p>Asset Service 通过 <code>fn init_genesis</code> 方法，注册了 Muta Tutorial Token，该 token 信息将包含在创世块的世界状态里：</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-rust codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// lib.rs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[genesis]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fn init_genesis(&amp;mut self, payload: InitGenesisPayload) -&gt; ProtocolResult&lt;()&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    let asset = Asset {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        id: payload.id,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name: payload.name,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        symbol: payload.symbol,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        supply: payload.supply,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        issuer: payload.issuer.clone(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    self.assets.insert(asset.id.clone(), asset.clone())?;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    let balance = Balance {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        current: payload.supply,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        locked: 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    self.sdk.set_account_value(&amp;asset.issuer, asset.id, balance)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// types.rs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Deserialize, Serialize, Clone, Debug)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct InitGenesisPayload {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub id: Hash,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub name: String,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub symbol: String,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub supply: u64,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub issuer: Address,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>该方法的输入参数 <code>InitGenesisPayload</code>，定义在 muta-tutorial-dex/config/genesis.toml 文件中，该文件包含所有 service 的创世配置信息：</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-toml codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># config/genesis.toml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[[services]]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">name = &quot;asset&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">payload = &#x27;&#x27;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;id&quot;: &quot;0xf56924db538e77bb5951eb5ff0d02b88983c49c45eea30e8ae3e7234b311436c&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;name&quot;: &quot;Muta Tutorial Token&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;symbol&quot;: &quot;MTT&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;supply&quot;: 1000000000,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;issuer&quot;: &quot;0xf8389d774afdad8755ef8e629e5a154fddc6325a&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;&#x27;&#x27;</span></div></div></div></div></div><p>框架在创建创世块时，会读取该配置并调用 <code>fn init_genesis</code> 方法。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="接口权限"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#接口权限" title="Direct link to heading">#</a>接口权限</h4><p>Asset Service 的 <code>fn lock</code>、<code>fn unlock</code>、<code>fn add_value</code>、<code>fn sub_value</code> 接口方法，只能被 Dex Service 调用，无法被用户直接调用。在 Asset Service 中定义了 <code>ADMISSION_TOKEN</code>，通过检验在 <code>ServiceContext</code> 中的 <code>extra</code> 字段是否包含该令牌进行权限控制。</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-rust codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">const ADMISSION_TOKEN: Bytes = Bytes::from_static(b&quot;dex_token&quot;);</span></div></div></div></div></div><blockquote><p>注意：由于框架正在持续的开发过程中，所以未来对调用的权限控制机制可能会修改</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="编写-dex-service"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#编写-dex-service" title="Direct link to heading">#</a>编写 Dex Service</h3><p>Dex Service 源码可以在 <a href="https://github.com/mkxbl/muta-tutorial-dex/tree/master/services/dex">这里</a> 找到，注意事项同上。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="3-将-service-接入框架，编译运行！"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#3-将-service-接入框架，编译运行！" title="Direct link to heading">#</a>3. 将 Service 接入框架，编译运行！</h2><p>前面已经提到，这部分工作将在 src 目录的 <a href="https://github.com/nervosnetwork/muta-template/blob/master/node-template/src/main.rs">main</a> 文件中完成。脚手架下载的 main 文件已经帮我们实现了绝大部分代码，所以这部分工作将变得非常简单。</p><p>在模版代码中，定义了一个 <code>struct DefaultServiceMapping</code> 结构体，并为该结构体实现了 <code>trait ServiceMapping</code>，框架通过 <code>trait ServiceMapping</code> 可以获取到所有 service 实例，从而将开发者定义的 service 接入框架底层组件。</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-rust codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">struct DefaultServiceMapping;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">impl ServiceMapping for DefaultServiceMapping {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fn get_service&lt;SDK: &#x27;static + ServiceSDK&gt;(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &amp;self,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name: &amp;str,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        sdk: SDK,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ) -&gt; ProtocolResult&lt;Box&lt;dyn Service&gt;&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        let service = match name {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;asset&quot; =&gt; Box::new(asset::AssetService::new(sdk)?) as Box&lt;dyn Service&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;metadata&quot; =&gt; Box::new(metadata::MetadataService::new(sdk)?) as Box&lt;dyn Service&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            _ =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return Err(MappingError::NotFoundService {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    service: name.to_owned(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                .into())</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Ok(service)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fn list_service_name(&amp;self) -&gt; Vec&lt;String&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        vec![&quot;asset&quot;.to_owned(), &quot;metadata&quot;.to_owned()]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p><code>trait ServiceMapping</code> 包含两个方法，一个 <code>fn get_service</code> 用来根据 service 名称获取 service 实例，另一个 <code>fn list_service_name</code> 用来获取所有 service 名称。</p><p>需要注意的是，框架将使用在 <code>fn list_service_name</code> 方法中 service 名称排列的顺序，依次调用 service 中 <code>#[genesis]</code> 或 <code>#[hook_before]</code> 或 <code>#[hook_after]</code> 标记的方法。</p><p>我们需要做的，仅仅是把 <code>fn get_service</code> 和 <code>fn list_service_name</code> 方法中的 service 集合，替换成我们 services 目录中包含的 service 集合：</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-rust codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">struct DefaultServiceMapping;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">impl ServiceMapping for DefaultServiceMapping {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fn get_service&lt;SDK: &#x27;static + ServiceSDK&gt;(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &amp;self,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name: &amp;str,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        sdk: SDK,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ) -&gt; ProtocolResult&lt;Box&lt;dyn Service&gt;&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        let service = match name {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;metadata&quot; =&gt; Box::new(metadata::MetadataService::new(sdk)?) as Box&lt;dyn Service&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;asset&quot; =&gt; Box::new(asset::AssetService::new(sdk)?) as Box&lt;dyn Service&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;dex&quot; =&gt; Box::new(dex::DexService::new(sdk)?) as Box&lt;dyn Service&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            _ =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return Err(MappingError::NotFoundService {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    service: name.to_owned(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                .into())</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Ok(service)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fn list_service_name(&amp;self) -&gt; Vec&lt;String&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        vec![&quot;metadata&quot;.to_owned(), &quot;asset&quot;.to_owned(), &quot;dex&quot;.to_owned()]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>到这里，所有的开发工作就完成了，运行 <code>cargo run</code> 编译并启动 dex 链。</p><p>通过浏览器打开 http://localhost:8000/graphiql ，即可与 dex 链进行交互，graphiql 的使用方法参见<a href="/muta-docs2/docs/graphql">文档</a>。</p><blockquote><p>注意：由于框架正在持续的开发过程中，所以框架的 api 有可能发生变动</p></blockquote></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/nervosnetwork/muta-docs/docs/dex.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/muta-docs2/docs/built_in_service"><div class="pagination-nav__link--sublabel">Previous</div><div class="pagination-nav__link--label">« 内置 Service 说明</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/muta-docs2/docs/graphql"><div class="pagination-nav__link--sublabel">Next</div><div class="pagination-nav__link--label">GraphQL »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#1-思考需要的-service" class="contents__link">1. 思考需要的 Service</a></li><li><a href="#2-开发-asset-service，dex-service" class="contents__link">2. 开发 Asset Service，Dex Service</a><ul><li><a href="#使用脚手架-muta-drone-对-service-进行初始化" class="contents__link">使用脚手架 muta-drone 对 Service 进行初始化</a></li><li><a href="#编写-asset-service" class="contents__link">编写 Asset Service</a></li><li><a href="#编写-dex-service" class="contents__link">编写 Dex Service</a></li></ul></li><li><a href="#3-将-service-接入框架，编译运行！" class="contents__link">3. 将 Service 接入框架，编译运行！</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/muta-docs2/docs/doc1">Style Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/muta-docs2/docs/doc2">Second Doc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/questions/tagged/docusaurus">Stack Overflow</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://discordapp.com/invite/docusaurus">Discord</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://twitter.com/docusaurus">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/muta-docs2/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/docusaurus">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 My Project, Inc. Built with Docusaurus.</div></div></div></footer>
</div>

<script src="/muta-docs2/styles.5d16af36.js"></script>

<script src="/muta-docs2/runtime~main.8a98f0f0.js"></script>

<script src="/muta-docs2/main.c645a1d4.js"></script>

<script src="/muta-docs2/1.570d2204.js"></script>

<script src="/muta-docs2/2.e2d3cc65.js"></script>

<script src="/muta-docs2/3.a6f7c6e9.js"></script>

<script src="/muta-docs2/1be78505.009a25e0.js"></script>

<script src="/muta-docs2/78ab87d2.97744ea4.js"></script>

<script src="/muta-docs2/17896441.ccc93767.js"></script>

<script src="/muta-docs2/75b4e168.ebe0ad04.js"></script>


</body>
</html>