(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{154:function(e,a,t){"use strict";t.r(a),t.d(a,"frontMatter",(function(){return b})),t.d(a,"metadata",(function(){return d})),t.d(a,"rightToc",(function(){return s})),t.d(a,"default",(function(){return u}));var n=t(1),c=t(9),r=(t(0),t(195)),b={id:"built_in_service",title:"\u5185\u7f6e Service \u8bf4\u660e"},d={id:"docs_zh/built_in_service",title:"\u5185\u7f6e Service \u8bf4\u660e",description:"## \u6982\u8ff0",source:"@site/docs/docs_zh/built_in_service.md",permalink:"/muta-docs2/docs/docs_zh/built_in_service",editUrl:"https://github.com/nervosnetwork/muta-docs/docs/docs_zh/built_in_service.md"},s=[{value:"\u6982\u8ff0",id:"\u6982\u8ff0",children:[]},{value:"Metadata Service",id:"metadata-service",children:[]},{value:"\u63a5\u53e3",id:"\u63a5\u53e3",children:[{value:"\u8bfb\u53d6\u94fe\u5143\u6570\u636e\u4fe1\u606f",id:"\u8bfb\u53d6\u94fe\u5143\u6570\u636e\u4fe1\u606f",children:[]}]},{value:"Asset Service",id:"asset-service",children:[]},{value:"\u63a5\u53e3",id:"\u63a5\u53e3-1",children:[]}],l={rightToc:s};function u(e){var a=e.components,t=Object(c.a)(e,["components"]);return Object(r.b)("wrapper",Object(n.a)({},l,t,{components:a,mdxType:"MDXLayout"}),Object(r.b)("h2",{id:"\u6982\u8ff0"},"\u6982\u8ff0"),Object(r.b)("p",null,"\u76ee\u524d Muta \u6846\u67b6\u6e90\u4ee3\u7801\u76ee\u524d\u5185\u7f6e\u4e86\u4e24\u4e2a built-in Service\uff1aMetadata Service \u548c Asset Service\u3002Metadata Service \u4e3a\u8d77\u94fe\u6240\u6bd4\u5982\u914d\u7f6e\u7684 Service\u3002\u5176\u4ed6 Service\uff08\u5305\u62ec Asset Service\uff09\u4e3a\u53ef\u9009\u914d\u7f6e\u3002"),Object(r.b)("h2",{id:"metadata-service"},"Metadata Service"),Object(r.b)("p",null,"\u7528\u6765\u5b58\u50a8\u94fe\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0c\u4ee5\u652f\u6301\u94fe\u7684\u8fd0\u8425\u65b9\u5728\u8d77\u94fe\u524d\u5bf9\u94fe\u7684\u76f8\u5173\u4fe1\u606f\u8fdb\u884c\u914d\u7f6e\u3002\u8fd9\u4e9b\u5143\u6570\u636e\u5305\u62ec\uff1a"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-rust"}),"pub struct Metadata {\n    pub chain_id:        Hash,\n    pub common_ref:      Hex, // BLS \u7b7e\u540d\u7b97\u6cd5\u7684\u516c\u5171\u53c2\u6570\n    pub timeout_gap:     u64, // (\u4ea4\u6613\u6709\u6548\u671f - \u5f53\u524d\u533a\u5757\u9ad8\u5ea6)\u7684\u6700\u5927\u503c\n    pub cycles_limit:    u64, // \u533a\u5757\u5168\u90e8\u4ea4\u6613\u6d88\u8017\u7684 cycles \u4e0a\u9650\n    pub cycles_price:    u64, // \u8282\u70b9\u8bbe\u7f6e\u7684\u4ea4\u6613\u6253\u5305\u8fdb\u533a\u5757\u7684\u6700\u5c0f cycles_price\n    pub interval:        u64, // \u533a\u5757\u4ea7\u751f\u95f4\u9694\n    pub verifier_list:   Vec<ValidatorExtend>, // \u5171\u8bc6\u9a8c\u8bc1\u4eba\u5217\u8868\n    pub propose_ratio:   u64, // \u5171\u8bc6 propose \u9636\u6bb5\u7684\u8d85\u65f6\u65f6\u95f4\u4e0e interval \u7684\u6bd4\u503c\n    pub prevote_ratio:   u64, // \u5171\u8bc6 prevote \u9636\u6bb5\u7684\u8d85\u65f6\u65f6\u95f4\u4e0e interval \u7684\u6bd4\u503c\n    pub precommit_ratio: u64, // \u5171\u8bc6 precommit \u9636\u6bb5\u7684\u8d85\u65f6\u65f6\u95f4\u4e0e interval \u7684\u6bd4\u503c\n    pub brake_ratio: u64 // \u5171\u8bc6\u91cd\u53d1 choke \u7684\u8d85\u65f6\u65f6\u95f4\u4e0e interval \u7684\u6bd4\u503c\n}\n\npub struct ValidatorExtend {\n    pub bls_pub_key:    Hex,\n    pub address:        Address,\n    pub propose_weight: u32, //\u51fa\u5757\u6743\u91cd\n    pub vote_weight:    u32, // \u6295\u7968\u6743\u91cd\n}\n")),Object(r.b)("p",null,"\u901a\u8fc7 Metadata Service \u53ef\u4ee5\u8bfb\u53d6\u8fd9\u4e9b\u4fe1\u606f\uff0c\u63a5\u53e3\u5982\u4e0b\uff1a "),Object(r.b)("h2",{id:"\u63a5\u53e3"},"\u63a5\u53e3"),Object(r.b)("h3",{id:"\u8bfb\u53d6\u94fe\u5143\u6570\u636e\u4fe1\u606f"},"\u8bfb\u53d6\u94fe\u5143\u6570\u636e\u4fe1\u606f"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-rust"}),"fn get_metadata(&self, ctx: ServiceContext) -> ProtocolResult<Metadata>\uff1b\n")),Object(r.b)("p",null,"GraphiQL \u793a\u4f8b\uff1a"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-graphql"}),'query get_metadata{\n  queryService(\n  caller: "0x016cbd9ee47a255a6f68882918dcdd9e14e6bee1"\n  serviceName: "metadata"\n  method: "get_metadata"\n  payload: ""\n  ){\n    ret,\n    isError\n  }\n}\n')),Object(r.b)("h2",{id:"asset-service"},"Asset Service"),Object(r.b)("p",null,"Asset service \u8d1f\u8d23\u7ba1\u7406\u94fe\u539f\u751f\u8d44\u4ea7\u4ee5\u53ca\u7b2c\u4e09\u65b9\u53d1\u884c\u8d44\u4ea7\u3002"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"\u8d44\u4ea7\u6210\u4e3a\u4e00\u7b49\u516c\u6c11\uff1a\u52a0\u5bc6\u8d44\u4ea7\u4f5c\u4e3a\u533a\u5757\u94fe\u7684\u6838\u5fc3\uff0c\u7406\u5e94\u6210\u4e3a\u4e00\u7b49\u516c\u6c11\u3002Asset \u6a21\u5757\u5229\u7528 Muta \u6846\u67b6\u63d0\u4f9b\u7684 service \u80fd\u529b\uff0c\u4e3a\u6240\u6709\u8d44\u4ea7\u63d0\u4f9b\u94fe\u7ea7\u522b\u7684\u652f\u6301\uff0c\u4e3a\u9762\u5411\u8d44\u4ea7\u7f16\u7a0b\u63d0\u4f9b\u652f\u6301\u3002")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"\u7b2c\u4e09\u65b9\u53d1\u884c\u8d44\u4ea7\uff1a \u7528\u6237\u53ef\u4ee5\u4f7f\u7528 Asset \u6a21\u5757\u53d1\u884c\u8d44\u4ea7\uff0c\u81ea\u5b9a\u4e49\u8d44\u4ea7\u5c5e\u6027\u548c\u603b\u91cf\u7b49")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"\u8d44\u4ea7\u4e0e\u5408\u7ea6\u4ea4\u4e92\uff1a \u672a\u6765\u53ef\u4ee5\u6253\u901a\u865a\u62df\u673a\u548c\u8d44\u4ea7\u6a21\u5757\uff0c\u4e3a\u8d44\u4ea7\u7684\u5e7f\u6cdb\u4f7f\u7528\u63d0\u4f9b\u652f\u6301"))),Object(r.b)("h2",{id:"\u63a5\u53e3-1"},"\u63a5\u53e3"),Object(r.b)("p",null,"Asset \u6a21\u5757\u91c7\u7528\u7c7b\u4f3c\u4ee5\u592a\u574a ERC-20 \u7684\u63a5\u53e3\u8bbe\u8ba1\uff0c\u4e3b\u8981\u5305\u542b\uff1a"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"\u53d1\u884c\u8d44\u4ea7")),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-rust"}),"// \u8d44\u4ea7\u6570\u636e\u7ed3\u6784\npub struct Asset {\n    pub id:     Hash,\n    pub name:   String,\n    pub symbol: String,\n    pub supply: u64,\n    pub issuer: Address,\n}\n\n// \u53d1\u884c\u8d44\u4ea7\u63a5\u53e3\n// \u8d44\u4ea7 ID \u81ea\u52a8\u751f\u6210\uff0c\u786e\u4fdd\u552f\u4e00\nfn create_asset(&mut self, ctx: ServiceContext, payload: CreateAssetPayload) -> ProtocolResult<Asset>;\n\n// \u53d1\u884c\u8d44\u4ea7\u53c2\u6570\npub struct CreateAssetPayload {\n    pub name:   String,\n    pub symbol: String,\n    pub supply: u64,\n}\n")),Object(r.b)("p",null,"GraphiQL \u793a\u4f8b\uff1a"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-graphql"}),'mutation create_asset{\n  unsafeSendTransaction(inputRaw: {\n    serviceName:"asset",\n    method:"create_asset",\n    payload:"{\\"name\\":\\"Test Coin\\",\\"symbol\\":\\"TC\\",\\"supply\\":100000000}",\n    timeout:"0x172",\n    nonce:"0x9db2d7efe2b61a88827e4836e2775d913a442ed2f9096ca1233e479607c27cf7",\n    chainId:"0xb6a4d7da21443f5e816e8700eea87610e6d769657d6b8ec73028457bf2ca4036",\n    cyclesPrice:"0x9999",\n    cyclesLimit:"0x9999"\n  }, inputPrivkey: "0x30269d47fcf602b889243722b666881bf953f1213228363d34cf04ddcd51dfd2"\n  )\n}\n')),Object(r.b)("ol",{start:2},Object(r.b)("li",{parentName:"ol"},"\u67e5\u8be2\u8d44\u4ea7\u4fe1\u606f")),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-rust"}),"// \u67e5\u8be2\u63a5\u53e3\nfn get_asset(&self, ctx: ServiceContext, payload: GetAssetPayload) -> ProtocolResult<Asset>\uff1b\n\n// \u67e5\u8be2\u53c2\u6570\npub struct GetAssetPayload {\n    pub id: Hash, // \u8d44\u4ea7 ID\n}\n")),Object(r.b)("p",null,"GraphiQL \u793a\u4f8b\uff1a"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-graphql"}),'query get_asset{\n  queryService(\n  caller: "0x016cbd9ee47a255a6f68882918dcdd9e14e6bee1"\n  serviceName: "asset"\n  method: "get_asset"\n  payload: "{\\"id\\": \\"0x5f1364a8e6230f68ccc18bc9d1000cedd522d6d63cef06d0062f832bdbe1a78a\\"}"\n  ){\n    ret,\n    isError\n  }\n}\n')),Object(r.b)("ol",{start:3},Object(r.b)("li",{parentName:"ol"},"\u8f6c\u8d26")),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-rust"}),"// \u8f6c\u8d26\u63a5\u53e3\nfn transfer(&mut self, ctx: ServiceContext, payload: TransferPayload) -> ProtocolResult<()>\uff1b\n\n// \u8f6c\u8d26\u53c2\u6570\npub struct TransferPayload {\n    pub asset_id: Hash,\n    pub to:       Address,\n    pub value:    u64,\n}\n")),Object(r.b)("p",null,"GraphiQL \u793a\u4f8b\uff1a"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-graphql"}),'mutation transfer{\n  unsafeSendTransaction(inputRaw: {\n    serviceName:"asset",\n    method:"transfer",\n    payload:"{\\"asset_id\\":\\"0x5f1364a8e6230f68ccc18bc9d1000cedd522d6d63cef06d0062f832bdbe1a78a\\",\\"to\\":\\"0xf8389d774afdad8755ef8e629e5a154fddc6325a\\", \\"value\\":10000}",\n    timeout:"0x289",\n    nonce:"0x9db2d7efe2b61a28827e4836e2775d913a442ed2f9096ca1233e479607c27cf7",\n    chainId:"0xb6a4d7da21443f5e816e8700eea87610e6d769657d6b8ec73028457bf2ca4036",\n    cyclesPrice:"0x9999",\n    cyclesLimit:"0x9999",\n    }, inputPrivkey: "0x30269d47fcf602b889243722b666881bf953f1213228363d34cf04ddcd51dfd2"\n  )\n}\n')),Object(r.b)("ol",{start:4},Object(r.b)("li",{parentName:"ol"},"\u67e5\u8be2\u4f59\u989d")),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-rust"}),"// \u67e5\u8be2\u63a5\u53e3\nfn get_balance(&self, ctx: ServiceContext, payload: GetBalancePayload) -> ProtocolResult<GetBalanceResponse> \n\n// \u67e5\u8be2\u53c2\u6570\npub struct GetBalancePayload {\n    pub asset_id: Hash,\n    pub user:     Address,\n}\n\n// \u8fd4\u56de\u503c\npub struct GetBalanceResponse {\n    pub asset_id: Hash,\n    pub user:     Address,\n    pub balance:  u64,\n}\n")),Object(r.b)("p",null,"GraphiQL \u793a\u4f8b\uff1a "),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-graphql"}),'query get_balance{\n  queryService(\n  caller: "0x016cbd9ee47a255a6f68882918dcdd9e14e6bee1"\n  serviceName: "asset"\n  method: "get_balance"\n  payload: "{\\"asset_id\\": \\"0x5f1364a8e6230f68ccc18bc9d1000cedd522d6d63cef06d0062f832bdbe1a78a\\", \\"user\\": \\"0x016cbd9ee47a255a6f68882918dcdd9e14e6bee1\\"}"\n  ){\n    ret,\n    isError\n  }\n}\n')),Object(r.b)("ol",{start:5},Object(r.b)("li",{parentName:"ol"},"\u6279\u51c6\u989d\u5ea6")),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-rust"}),"// \u6279\u51c6\u63a5\u53e3\nfn approve(&mut self, ctx: ServiceContext, payload: ApprovePayload) -> ProtocolResult<()>;\n\n// \u6279\u51c6\u53c2\u6570\npub struct ApprovePayload {\n    pub asset_id: Hash,\n    pub to:       Address,\n    pub value:    u64,\n}\n")),Object(r.b)("p",null,"GraphiQL \u793a\u4f8b\uff1a "),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-graphql"}),'  unsafeSendTransaction(inputRaw: {\n    serviceName:"asset",\n    method:"approve",\n    payload:"{\\"asset_id\\":\\"0x5f1364a8e6230f68ccc18bc9d1000cedd522d6d63cef06d0062f832bdbe1a78a\\",\\"to\\":\\"0xf8389d774afdad8755ef8e629e5a154fddc6325a\\", \\"value\\":10000}",\n    timeout:"0x378",\n    nonce:"0x9db2d7efe2b61a28827e4836e2775d913a442ed2f9096ca1233e479607c27cf7",\n    chainId:"0xb6a4d7da21443f5e816e8700eea87610e6d769657d6b8ec73028457bf2ca4036",\n    cyclesPrice:"0x9999",\n    cyclesLimit:"0x9999",\n    }, inputPrivkey: "0x30269d47fcf602b889243722b666881bf953f1213228363d34cf04ddcd51dfd2"\n  )\n}\n')),Object(r.b)("ol",{start:6},Object(r.b)("li",{parentName:"ol"},"\u6388\u6743\u8f6c\u8d26")),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-rust"}),"// \u63a5\u53e3\nfn transfer_from(&mut self, ctx: ServiceContext, payload: TransferFromPayload) -> ProtocolResult<()>\uff1b\n\n// \u53c2\u6570\npub struct TransferFromPayload {\n    pub asset_id:  Hash,\n    pub sender:    Address,\n    pub recipient: Address,\n    pub value:     u64,\n}\n")),Object(r.b)("p",null,"GraphiQL \u793a\u4f8b\uff1a"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-graphql"}),'mutation transfer_from{\n  unsafeSendTransaction(inputRaw: {\n    serviceName:"asset",\n    method:"transfer_from",\n    payload:"{\\"asset_id\\":\\"0x5f1364a8e6230f68ccc18bc9d1000cedd522d6d63cef06d0062f832bdbe1a78a\\",\\"sender\\":\\"0x016cbd9ee47a255a6f68882918dcdd9e14e6bee1\\", \\"recipient\\":\\"0xfffffd774afdad8755ef8e629e5a154fddc6325a\\", \\"value\\":5000}",\n    timeout:"0x12c",\n    nonce:"0x9db2d7efe2b61a28827e4836e2775d913a442ed2f9096ca1233e479607c27cf7",\n    chainId:"0xb6a4d7da21443f5e816e8700eea87610e6d769657d6b8ec73028457bf2ca4036",\n    cyclesPrice:"0x9999",\n    cyclesLimit:"0x9999",\n    }, inputPrivkey: "0x45c56be699dca666191ad3446897e0f480da234da896270202514a0e1a587c3f"\n  )\n}\n')),Object(r.b)("ol",{start:7},Object(r.b)("li",{parentName:"ol"},"\u67e5\u8be2\u9650\u989d")),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-rust"}),"// \u67e5\u8be2\u63a5\u53e3\nfn get_allowance(&self, ctx: ServiceContext, payload: GetAllowancePayload) -> ProtocolResult<GetAllowanceResponse>\uff1b\n\n// \u67e5\u8be2\u53c2\u6570\npub struct GetAllowancePayload {\n    pub asset_id: Hash,\n    pub grantor:  Address,\n    pub grantee:  Address,\n}\n\n// \u8fd4\u56de\u503c\npub struct GetAllowanceResponse {\n    pub asset_id: Hash,\n    pub grantor:  Address,\n    pub grantee:  Address,\n    pub value:    u64,\n}\n")),Object(r.b)("p",null,"GraphiQL \u793a\u4f8b\uff1a"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-graphql"}),'query get_allowance{\n  queryService(\n  caller: "0x016cbd9ee47a255a6f68882918dcdd9e14e6bee1"\n  serviceName: "asset"\n  method: "get_allowance"\n  payload: "{\\"asset_id\\": \\"0x5f1364a8e6230f68ccc18bc9d1000cedd522d6d63cef06d0062f832bdbe1a78a\\", \\"grantor\\": \\"0x016cbd9ee47a255a6f68882918dcdd9e14e6bee1\\", \\"grantee\\": \\"0xf8389d774afdad8755ef8e629e5a154fddc6325a\\"}"\n  ){\n    ret,\n    isError\n  }\n}\n')))}u.isMDXComponent=!0},195:function(e,a,t){"use strict";t.d(a,"a",(function(){return o})),t.d(a,"b",(function(){return f}));var n=t(0),c=t.n(n);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function b(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function d(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?b(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):b(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function s(e,a){if(null==e)return{};var t,n,c=function(e,a){if(null==e)return{};var t,n,c={},r=Object.keys(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||(c[t]=e[t]);return c}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(c[t]=e[t])}return c}var l=c.a.createContext({}),u=function(e){var a=c.a.useContext(l),t=a;return e&&(t="function"==typeof e?e(a):d({},a,{},e)),t},o=function(e){var a=u(e.components);return c.a.createElement(l.Provider,{value:a},e.children)},p={inlineCode:"code",wrapper:function(e){var a=e.children;return c.a.createElement(c.a.Fragment,{},a)}},i=Object(n.forwardRef)((function(e,a){var t=e.components,n=e.mdxType,r=e.originalType,b=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),o=u(t),i=n,f=o["".concat(b,".").concat(i)]||o[i]||p[i]||r;return t?c.a.createElement(f,d({ref:a},l,{components:t})):c.a.createElement(f,d({ref:a},l))}));function f(e,a){var t=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var r=t.length,b=new Array(r);b[0]=i;var d={};for(var s in a)hasOwnProperty.call(a,s)&&(d[s]=a[s]);d.originalType=e,d.mdxType="string"==typeof e?e:n,b[1]=d;for(var l=2;l<r;l++)b[l]=t[l];return c.a.createElement.apply(null,b)}return c.a.createElement.apply(null,t)}i.displayName="MDXCreateElement"}}]);